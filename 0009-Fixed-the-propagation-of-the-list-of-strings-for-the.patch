From 1b113f55fc436db5736af8d96127701134858976 Mon Sep 17 00:00:00 2001
From: P0psicles <rogier@headshots.nl>
Date: Fri, 2 Mar 2018 23:12:00 +0100
Subject: [PATCH 9/9] Fixed the propagation of the list of strings for the
 requiredWords and ignoredWords ui select list component.

---
 themes/dark/assets/css/style.css                       | 11 ++++++++++-
 themes/dark/templates/editShow.mako                    | 11 ++++++-----
 themes/dark/templates/vue-components/selectListUi.mako | 16 +++++++++++++++-
 3 files changed, 31 insertions(+), 7 deletions(-)

diff --git a/themes/dark/assets/css/style.css b/themes/dark/assets/css/style.css
index 0ae72c0..6582d69 100644
--- a/themes/dark/assets/css/style.css
+++ b/themes/dark/assets/css/style.css
@@ -1763,6 +1763,15 @@ td.col-group {
     border-radius: 3px;
 }
 
+
+/* =======================================================================
+editShow.mako
+========================================================================== */
+
+input.btn.btn-inline.fileBrowser {
+    margin: 2px 2px 2px 2px;
+}
+
 #editShow {
     width: 700px;
     padding-top: 10px;
@@ -2063,7 +2072,7 @@ config*.mako
     font-size: 12px;
     font-weight: normal;
     display: block;
-    width: 475px;
+    /* width: 475px; */
     margin-left: 182px;
 }
 
diff --git a/themes/dark/templates/editShow.mako b/themes/dark/templates/editShow.mako
index 3709623..2f714b9 100644
--- a/themes/dark/templates/editShow.mako
+++ b/themes/dark/templates/editShow.mako
@@ -171,7 +171,7 @@
                             <label for="rls_ignore_words">
                                 <span class="component-title">Ignored Words</span>
                                 <span class="component-desc">
-                                    <select-list :list-items="transformToIndexedObject(seriesObj.config.release.ignoredWords)" @change="onChangeIgnoredWords"></select-list>
+                                    <select-list v-if="seriesObj.config.release.ignoredWords !== null" :list-items="seriesObj.config.release.ignoredWords" @change="onChangeIgnoredWords"></select-list>
                                     <div class="clear-left">
                                         <p>comma-separated <i>e.g. "word1,word2,word3"</i></p>
                                         <p>Search results with one or more words from this list will be ignored.</p>
@@ -183,7 +183,7 @@
                             <label for="rls_require_words">
                                 <span class="component-title">Required Words</span>
                                 <span class="component-desc">
-                                    <select-list :list-items="transformToIndexedObject(seriesObj.config.release.requiredWords)" @change="onChangeRequiredWords"></select-list>
+                                    <select-list v-if="seriesObj.config.release.requiredWords !== null" :list-items="seriesObj.config.release.requiredWords" @change="onChangeRequiredWords"></select-list>
                                     <div class="clear-left">
                                         <p>comma-separated <i>e.g. "word1,word2,word3"</i></p>
                                         <p>Search results with no words from this list will be ignored.</p>
@@ -251,8 +251,8 @@ var startVue = function() {
                         airByDate: false,
                         subtitlesEnabled: false,
                         release: {
-                            requiredWords: [],
-                            ignoredWords: [],
+                            requiredWords: null,
+                            ignoredWords: null,
                             blacklist: [],
                             whitelist: []
                         }
@@ -264,7 +264,8 @@ var startVue = function() {
                     {text: 'Skipped', value: 'Skipped'},
                     {text: 'Ignored', value: 'Ignored'}
                 ],
-                saveStatus: ''
+                saveStatus: '',
+                seriesLoaded: false
             }
         },
         async mounted() {
diff --git a/themes/dark/templates/vue-components/selectListUi.mako b/themes/dark/templates/vue-components/selectListUi.mako
index 66179a6..917cf35 100644
--- a/themes/dark/templates/vue-components/selectListUi.mako
+++ b/themes/dark/templates/vue-components/selectListUi.mako
@@ -14,7 +14,7 @@
         template: '#select-list',
         props: ['listItems'],
         mounted() {
-            this.editItems = this.listItems;
+            this.editItems = this.sanitize(this.listItems);
         },
         data: function() {
             return {
@@ -37,6 +37,20 @@
                 this.editItems = this.editItems.filter(e => e !== item);
                 this.newItem = item.value;
                 this.sendValues();
+            },
+            sanitize: function(items) {
+                if (items.filter(item => typeof(item) === 'string').length) {
+                    return this.transformToIndexedObject(items);
+                } else {
+                    return items;
+                }
+            },
+            transformToIndexedObject: arrayOfStrings => {
+                arrayOfObjects = [];
+                for (let index=0; index < arrayOfStrings.length; index++) {
+                    arrayOfObjects.push({id: index, value: arrayOfStrings[index]});
+                }
+                return arrayOfObjects;
             }
         }
     });
-- 
2.6.3.windows.1

